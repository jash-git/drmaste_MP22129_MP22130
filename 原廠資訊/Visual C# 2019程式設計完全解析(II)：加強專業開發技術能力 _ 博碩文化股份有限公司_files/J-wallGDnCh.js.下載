;/*FB_PKG_DELIM*/

__d("MAWDropCutoverThreadsTable",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var c=d("ReQL").fromTableAscending(a.table("cutover_threads"));return d("ReQL").toArrayAsync(c).then(function(c){return c.reduce(function(b,c){return b.then(function(){return a.table("cutover_threads")["delete"](c.openThreadId)})},(h||(h=b("Promise"))).resolve())})}g.call=a}),98);
__d("MAWLSVaultingHooks",["ReStoreVaulting"],(function(a,b,c,d,e,f,g){"use strict";a={onAfterEntriesNext:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeVaultDbRow(a,b)},onAfterGet:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeVaultDbRow(a,b)},onBeforeAdd:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeUnvaultDbRow(a,b)},onBeforeDeleteThenInsert:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeUnvaultDbRow(a,b)},onBeforeNotify:function(a){var b=a.newValue,c=a.prevValue;a=a.tableName;return{newValue:d("ReStoreVaulting").maybeVaultDbRow(b,a),prevValue:d("ReStoreVaulting").maybeVaultDbRow(c,a)}},onBeforePut:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeUnvaultDbRow(a,b)},onBeforeUpsert:function(a){var b=a.tableName;a=a.value;return d("ReStoreVaulting").maybeUnvaultDbRow(a,b)}};g["default"]=a}),98);
__d("LSStorage",["LSDbKeyComparer","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,d,e){a=a.tableNames[b];b=a.indexes;a=a.primaryKeyIds;a=e==null?a:b[e];return a.map(function(a){if(d[a]!==void 0||e!=null)return d[a];throw c("unrecoverableViolation")("primary key must be defined on object","messenger_web_product")})}function b(a,b){return(h||(h=d("LSDbKeyComparer"))).compareKey(a,b)===0}g.searchKey=a;g.areKeysEqual=b}),98);
__d("I64MigrationHelper",["I64","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return c("nullthrows")((h||(h=d("I64"))).cast(a))}g.cast=a}),98);
__d("LSTableDefaults",["I64MigrationHelper"],(function(a,b,c,d,e,f){e.exports={sync_groups:{syncStatus:(a=b("I64MigrationHelper")).cast([0,0]),sendSyncParams:!1,minTimeToSyncTimestampMs:a.cast([0,0]),canIgnoreTimestamp:!1,priority:a.cast([0,0]),lastSyncRequestTimestampMs:a.cast([0,0]),lastSyncCompletedTimestampMs:a.cast([0,0]),syncChannel:a.cast([0,1])},pending_tasks:{enqueueTimestampMs:a.cast([0,0]),firstExecutedTimestampMs:a.cast([0,0]),failureCount:a.cast([0,0]),minTimeToSyncTimestampMs:a.cast([0,0]),pluginType:a.cast([0,0]),priority:a.cast([0,0]),taskDispatchPriority:a.cast([0,0])},pending_fire_and_forget_tasks:{enqueueTimestampMs:a.cast([0,0]),priority:a.cast([0,0])},contacts:{isMessengerUser:!1,isMemorialized:!1,blockedByViewerStatus:a.cast([0,0]),rank:a.cast([0,0]),contactType:a.cast([0,0]),contactTypeExact:a.cast([0,0]),canViewerMessage:!0,gender:a.cast([0,0]),authorityLevel:a.cast([0,0]),optimisticBlockedByViewerStatus:a.cast([0,0]),optimisticBlockedByViewerStatusTimestampMs:a.cast([0,0]),contactReachabilityStatusType:a.cast([0,0]),restrictionType:a.cast([0,0]),waConnectStatus:a.cast([0,0]),capabilities2:a.cast([0,0]),isEmployee:!1},ig_contact_info:{e2eeEligibility:a.cast([0,0])},bot_profile_info_v2:{hasEmbodiment:!1},reactions:{timestampMs:a.cast([0,0]),authorityLevel:a.cast([0,0])},threads:{lastActivityTimestampMs:a.cast([0,0]),lastReadWatermarkTimestampMs:a.cast([0,0]),removeWatermarkTimestampMs:a.cast([0,0]),muteExpireTimeMs:a.cast([0,0]),isAdminSnippet:!1,ongoingCallState:a.cast([0,0]),snippetHasEmoji:!1,hasPersistentMenu:!1,disableComposerInput:!1,capabilities:a.cast([0,0]),isCustomThreadPicture:!1,isDisappearingMode:!1,unreadDisappearingMessageCount:a.cast([0,0]),authorityLevel:a.cast([0,0]),capabilities2:a.cast([0,0]),muteCallsExpireTimeMs:a.cast([0,0]),unsendLimitMs:a.cast([0,0]),threadInvitesEnabled:a.cast([0,0]),threadInvitesEnabledV2:a.cast([0,0]),capabilities3:a.cast([0,0]),muteMentionExpireTimeMs:a.cast([0,0]),isReadReceiptsDisabled:!1,readReceiptsDisabledV2:a.cast([0,0]),capabilities4:a.cast([0,0])},threads_ranges_v2__generated:{minThreadKey:a.cast([0,0]),minLastActivityTimestampMs:a.cast([0,0]),maxThreadKey:a.cast([0,0]),maxLastActivityTimestampMs:a.cast([0,0]),isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:!1,hasMoreAfter:!1},messages:{timestampMs:a.cast([0,0]),primarySortKey:a.cast([0,0]),secondarySortKey:a.cast([0,0]),isAdminMessage:!1,sendStatus:a.cast([0,0]),sendStatusV2:a.cast([0,0]),isUnsent:!1,replyStatus:a.cast([0,0]),replyAttachmentType:a.cast([0,0]),hasQuickReplies:!1,textHasLinks:!1,viewFlags:a.cast([0,0]),displayedContentTypes:a.cast([0,1]),quickReplyType:a.cast([0,0]),authorityLevel:a.cast([0,0]),unsentTimestampMs:a.cast([0,0]),isCollapsed:!1,messageRenderingType:a.cast([0,0])},messages_ranges_v2__generated:{isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:!1,hasMoreAfter:!1},participants:{readWatermarkTimestampMs:a.cast([0,0]),deliveredWatermarkTimestampMs:a.cast([0,0]),authorityLevel:a.cast([0,0]),readActionTimestampMs:a.cast([0,0]),groupParticipantJoinState:a.cast([0,0]),threadRoles:a.cast([0,0])},attachments:{timestampMs:a.cast([0,0]),attachmentType:a.cast([0,0]),hasMedia:!1,isSharable:!1,hasXma:!1,attachmentIndex:a.cast([0,0]),authorityLevel:a.cast([0,0])},attachments_ranges_v2__generated:{mediaGroup:a.cast([0,0]),isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:!1,hasMoreAfter:!1},attachment_items:{attachmentIndex:a.cast([0,0])},group_membership_approval_requests:{authorityLevel:a.cast([0,0])},admin_message_ctas:{timestampMs:a.cast([0,0]),showAdChoiceIcon:!1},thread_nullstate:{ctaType:a.cast([0,0]),privacyTextCtaType:a.cast([0,0])},messages_status:{timestampMs:a.cast([0,0])},polls:{pollType:a.cast([0,0])},poll_options_v2:{voteCount:a.cast([0,0]),sortKeyVotingTimestamp:a.cast([0,0]),sortKeyCreationTimestamp:a.cast([0,0])},filtered_threads_ranges_v3__generated:{minThreadKey:a.cast([0,0]),minLastActivityTimestampMs:a.cast([0,0]),maxThreadKey:a.cast([0,0]),maxLastActivityTimestampMs:a.cast([0,0]),isLoadingBefore:!1,isLoadingAfter:!1,hasMoreBefore:!1,hasMoreAfter:!1,folderName:"inbox",secondaryThreadRangeFilter:a.cast([0,0]),threadRangeFilterValue:""},community_folders:{capabilities:a.cast([0,0]),notificationMutedUntil:a.cast([0,0]),inviteStatus:a.cast([0,0]),capabilities2:a.cast([0,0]),capabilities3:a.cast([0,0])},community_members:{source:a.cast([0,0]),adminActions:a.cast([0,0]),contactCapabilities:a.cast([0,0]),channelBadges:a.cast([0,0]),threadRoles:a.cast([0,0]),requestId:""},inbox_threads_ranges:{minThreadKey:a.cast([0,0]),minLastActivityTimestampMs:a.cast([0,0]),isLoadingBefore:!1,hasMoreBefore:!1},community_direct_invites_presets:{fallbackUrl:"",pictureUrlExpirationTimestampMs1:a.cast([0,0]),pictureUrlExpirationTimestampMs2:a.cast([0,0]),presetTypeV2:"ALL_MEMBERS"},sync_group_threads_ranges:{minThreadKey:a.cast([0,0]),minLastActivityTimestampMs:a.cast([0,0]),isLoadingBefore:!1,hasMoreBefore:!1},community_chat_polls:{pollType:a.cast([0,0])},community_chat_poll_options:{voteCount:a.cast([0,0]),sortKeyVotingTimestamp:a.cast([0,0]),sortKeyCreationTimestamp:a.cast([0,0])},reactions_v2:{viewerReactionTimestampMs:a.cast([0,0]),lastUpdatedTimestampMs:a.cast([0,0])},group_invitations_pending:{communityJoinRequestStatus:a.cast([0,0]),communityParticipationControlRequestStatus:a.cast([0,0]),communityParticipationControlSetting:a.cast([0,0])},thread_label_mappings:{sortKey:a.cast([0,0])},inbox_view_state:{value:""},inbox_view_state_v2:{value:""},discoverable_chat_participants:{source:a.cast([0,0])},roll_calls:{viewerHasContributed:!1,viewerCanEditPrompt:!1,isBlurred:!1,canViewWithoutContributing:!1},roll_call_contributions_v2:{contributorId:a.cast([0,0]),contributionSource:a.cast([0,0])},shared_albums:{lastActivityTimestampMs:a.cast([0,0]),contributionCount:a.cast([0,0])},shared_album_contributions:{creationTimestampMs:a.cast([0,0]),creatorId:a.cast([0,0])},search_queries:{surfaceType:a.cast([0,1])},universal_search_recent_searches:{lastAccessedTimestampMs:a.cast([0,0])},cm_search_nullstate_metadata:{score:0},ai_bot_search_metadata:{displayName:"",contactViewerRelationship:a.cast([0,0]),score:0},contact_upload_settings:{authorityLevel:a.cast([0,0])},presence_settings:{isActiveStatusViewable:!1,isActiveStatusViewableOnFb:!1,isActiveStatusViewableOnMessenger:!1,hasConvertedToViewSideSettings:!1},video_chat_links_joining:{canAnonymousUsersJoin:a.cast([0,0])},notification_settings:{includeInSwitchAccountBadges:!1,mutePageAccountMessageReminder:!1},avatar_settings:{enableAvatarHotlike:!1},messaging_privacy_settings:{readReceiptsDisabled:a.cast([0,0])},rtc_call_events:{isProcessed:!1},transaction_history:{timestampMs:a.cast([0,0])},thread_themes:{isDeprecated:!1,iconUrl:"",iconUrlFallback:"",backgroundUrl:""},ranking_scores:{score:a.cast([0,0]),scoreIndex:a.cast([0,0])},story_buckets:{pageNum:a.cast([0,0]),readState:a.cast([0,0])},stories:{authorityLevel:a.cast([0,0])},story_viewers:{interactionType:a.cast([0,1]),authorityLevel:a.cast([0,0])},story_reactions:{authorityLevel:a.cast([0,0])},story_ad_unit:{shouldShowAdChoice:!1},story_overlays:{authorityLevel:a.cast([0,0])},rooms:{notificationMutedUntilMs:a.cast([0,0])},media_staging:{progress:a.cast([0,0])},client_messages:{textSize:a.cast([0,0]),sendStatus:a.cast([0,0]),isHidden:!1,isTombstoned:!1,isReplyOnly:!1,messageContentType:a.cast([0,0]),messageContentSubtype:a.cast([0,0]),messageSource:a.cast([0,0]),messageCreationType:a.cast([0,0]),messageEphemeralityType:a.cast([0,0]),replyStatus:a.cast([0,0]),replyMessageTextSize:a.cast([0,0]),replyVicinityStatus:a.cast([0,0]),isForwarded:!1,isReadonly:!1,disabledActionsReason:a.cast([0,0]),shouldPersist:!1,shouldHideInSnippet:!1},client_participants:{isPending:!1,capabilities1:a.cast([0,0]),capabilities2:a.cast([0,0]),readActionTsMs:a.cast([0,0])},client_threads:{isAdminSnippet:!1,isHotlikeSnippet:!1,groupMemberAddMode:a.cast([0,0]),capabilities1:a.cast([0,0]),capabilities2:a.cast([0,0]),isHidden:!1,isTombstoned:!1,isPending:!1,isShadowThread:!1,pinnedMessagesCount:a.cast([0,0])},data_trace_meta:{initTimestampMs:a.cast([0,0]),foregroundTimestampMs:a.cast([0,0]),traceType:a.cast([0,0]),shouldFlush:!1},data_trace_addon:{timestampMs:a.cast([0,0])},secure_encrypted_backups_client_state:{authorityLevel:a.cast([0,0]),encryptionVersion:a.cast([0,0]),revisionVersion:a.cast([0,0])},secure_encrypted_backups_epochs:{authorityLevel:a.cast([0,0])},encrypted_backups:{authorityLevel:a.cast([0,0]),hasOtcEligibleDevices:!1},secure_encrypted_backups_generated_recovery_code:{virtualDeviceType:a.cast([0,1])},encrypted_backups_virtual_devices:{virtualDeviceType:a.cast([0,1]),removalStatus:a.cast([0,1]),requiresHsmMigration:!1},encrypted_backups_metadata:{authorityLevel:a.cast([0,0])},cutover_threads:{isMigrated:!1,showOpenMessageHistory:!1},persistent_menu_ctas:{ctaType:"fallback"},lightspeed_task_context:{requiresAuthentication:!1}}}),null);
__d("MWTabNotifierWhenPDBEnabled",["cr:3107"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:3107")}),98);
__d("ReStoreUtils",["LSTableDefaults","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=[],c=(yield a.next());while(!c.done)b.push(c.value),c=(yield a.next());return b});return h.apply(this,arguments)}function d(a,b){var d=c("LSTableDefaults")[b];return!d?a:Object.keys(d).reduce(function(a,b){Object.prototype.hasOwnProperty.call(a,b)||(a[b]=d[b]);return a},babelHelpers["extends"]({},a))}g.collectIterator=a;g.appendDefaultValues=d}),98);
__d("ReStoreDefaultValueMigration",["LSPlatformLsInitLog","LSTableDefaults","ReStoreDefaultValuesMetadata","ReStoreUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c={};b=(yield d("ReStoreUtils").collectIterator(b.table(d("ReStoreDefaultValuesMetadata").defaultValuesTableName).entries(a)));for(a of b){b=a[0];var e=a[1];if(b!=null){var f;b=d("ReStoreDefaultValuesMetadata").tryParseDefaultValuesData(e);if(b==null)continue;e=b.columns;b=b.tableName;c[b]=(f=c[b])!=null?f:new Set();for(f of e)c[b].add(f)}}return c});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d){a=(yield h(a,b));b={};for(d in d.tableNames){var e=c("LSTableDefaults")[d];if(e!=null)for(var f in e){var g;g=(g=a[d])==null?void 0:g.has(f);if(!g){b[d]=(g=b[d])!=null?g:{};b[d][f]=e[f]}}}return b});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){for(b in b){var e=Object.keys(c("LSTableDefaults")[b]||{});e={columns:e,tableName:b};yield a.table(d("ReStoreDefaultValuesMetadata").defaultValuesTableName).put(d("ReStoreDefaultValuesMetadata").defaultValuesColumnToValue(e))}});return m.apply(this,arguments)}function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new WeakMap();d("LSPlatformLsInitLog").addPoint("default_values_update_start");var e=function(a,b){d("LSPlatformLsInitLog").addPoint("default_values_update_end_failure",{string:{default_values_update_failure_point:b,default_values_update_failure_reason:String(a)}})};try{b=(yield j(c,a,b));try{for(var f in b){var g=a.table(f).entries(c),h=(yield g.next());while(!h.done){var i=babelHelpers["extends"]({},h.value[1]);i=d("ReStoreUtils").appendDefaultValues(i,f);yield a.table(f).put(i);h=(yield g.next())}}yield l(a,b);d("LSPlatformLsInitLog").addPoint("default_values_update_end")}catch(a){e(a,"setDefaultValues")}}catch(a){e(a,"findDefaultValuesToUpdate")}});return n.apply(this,arguments)}g.runMigrationForTableDefaultValuesIfNeeded=a}),98);
__d("ReStoreHooks",["PromiseOrValue"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return{afterEntriesNext:a.reduce(function(a,b){var c=b.onAfterEntriesNext;return c?function(b){return c({tableName:b.tableName,value:a(b)})}:a},function(a){a=a.value;return a}),afterGet:a.reduce(function(a,b){var c=b.onAfterGet;return c?function(b){return c({tableName:b.tableName,value:a(b)})}:a},function(a){a=a.value;return a}),beforeAdd:a.reduce(function(a,b){var c=b.onBeforeAdd;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers["extends"]({},b,{value:a}))})}:a},function(a){a=a.value;return a}),beforeDeleteThenInsert:a.reduce(function(a,b){var c=b.onBeforeDeleteThenInsert;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers["extends"]({},b,{value:a}))})}:a},function(a){a=a.value;return a}),beforeNotify:a.reduce(function(a,b){var c=b.onBeforeNotify;return c?function(b){var d=a(b),e=d.newValue;d=d.prevValue;return c({newValue:e,prevValue:d,tableName:b.tableName})}:a},function(a){var b=a.newValue;a=a.prevValue;return{newValue:b,prevValue:a}}),beforePut:a.reduce(function(a,b){var c=b.onBeforePut;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers["extends"]({},b,{value:a}))})}:a},function(a){a=a.value;return a}),beforeUpsert:a.reduce(function(a,b){var c=b.onBeforeUpsert;return c?function(b){return(h||(h=d("PromiseOrValue"))).map(a(b),function(a){return c(babelHelpers["extends"]({},b,{value:a}))})}:a},function(a){a=a.value;return a})}}g.createHookManager=a}),98);
__d("ReStoreIndicesMigration",["LSPlatformLsInitLog","ReStoreIndexMetadata","ReStoreUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c={};b=(yield d("ReStoreUtils").collectIterator(b.table(d("ReStoreIndexMetadata").indicesTableName).entries(a)));for(a of b){b=a[0];var e=a[1];if(b!=null){var f;e=d("ReStoreIndexMetadata").tryParseIndexData(e);if(e==null)continue;var g=e.indexName,h=e.tableName;c[h]=(f=c[h])!=null?f:{};c[h][g]={index:e.data,key:b}}}return c});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield h(a,b));b={};for(var e in c.tableNames){var f=c.tableNames[e];for(var g in f.indexes){var i,j=f.indexes[g];i=(i=a[e])==null?void 0:i[g];if(d("ReStoreIndexMetadata").indicesDiffer(i==null?void 0:i.index,j)){b[e]=(i=b[e])!=null?i:{};b[e][g]=j}}}i={};for(j in a){g=a[j];for(f in g){var k;e=g[f];k=(k=c.tableNames[j])==null?void 0:(k=k.indexes)==null?void 0:k[f];if(k==null){i[j]=(k=i[j])!=null?k:{};i[j][f]=e}}}return{toRemove:i,toUpdate:b}});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){for(var c in b){var e=b[c];for(var f in e){var g=e[f];g={data:g,indexName:f,tableName:c};yield a.table(d("ReStoreIndexMetadata").indicesTableName).put(d("ReStoreIndexMetadata").indexDataToValue(g))}}});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){for(var c in b){var e=b[c];for(var f in e){var g,h=e[f].key;yield (g=a.table(d("ReStoreIndexMetadata").indicesTableName))["delete"].apply(g,h)}}});return o.apply(this,arguments)}function a(a,c,e){var f=new WeakMap();d("LSPlatformLsInitLog").addPoint("index_migration_start");var g=function(a,b){d("LSPlatformLsInitLog").addPoint("index_migration_end_failure",{string:{index_migration_failure_point:b,index_migration_failure_reason:String(a)}})};return j(f,a,c).then(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=b.toRemove;b=b.toUpdate;var g=Array.from(new Set([].concat(Object.keys(b),Object.keys(f))));d("LSPlatformLsInitLog").addAnnotations({"int":{index_migration_rebuild_tables_count:g.length},string_array:{index_migration_rebuilt_tables:g}});for(g of g)if(c.tableNames[g]!=null){var h;h=Array.from(new Set([].concat(Object.keys((h=b[g])!=null?h:{}),Object.keys((h=f[g])!=null?h:{}))));yield e(g,h)}yield l(a,b);yield n(a,f);d("LSPlatformLsInitLog").addPoint("index_migration_end")});return function(a){return f.apply(this,arguments)}}(),function(a){return g(a,"findIndicesToUpdateOrRemove")})["catch"](function(a){return g(a,"rebuildIndices")})}g.runMigrationForIndicesIfNeeded=a}),98);
__d("ReStorePersistence",["FBLogger","PromiseOrValue","asyncToGeneratorRuntime","isPromise"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={SENTINEL_DELETED:1};function k(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function l(b){if(b==null)return b;var c=Object.getOwnPropertyNames(b),a={},d,e;for(d=0;d<c.length;d++)e=b[c[d]],a[c[d]]=e;return a}function m(a,b){b===void 0&&(b=j);return a===b}function a(a){var e;return{clearCache:a.clearCache,close:a.close,createTransaction:function(e){var f=new Map(),g=!1;function n(){if(g)throw c("FBLogger")("messenger_web_product").mustfixThrow("Transaction has closed")}return{close:function(){g=!0},flush:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b===void 0&&(b={upgrade:!1}),yield a.flush(f,b),g=!0});function d(a){return c.apply(this,arguments)}return d}(),table:function(b){function g(c,d){n();var f=p.get(d);if(m(f))return void 0;return f!==void 0?f:a.get(c,b,d,e)}function o(c,f){return(i||(i=d("PromiseOrValue"))).map(g(c,f),function(c){if(c===void 0){var d=p.get(f);a.logError==null?void 0:a.logError(b,e,"dbCorruption",{deletedInThisTxn:m(d)?"true":"false",id:JSON.stringify(f)||""})}return c})}var p=k(f,b,function(){return new Map()});function q(a,b){return{read:function*(b){b=g(a,b);return(h||(h=c("isPromise")))(b)?yield b:b},readExn:function*(b){b=o(a,b);return(h||(h=c("isPromise")))(b)?yield b:b},readHeader:function*(){var d=g(a,b);return(h||(h=c("isPromise")))(d)?yield d:d},remove:function*(a){n(),p.set(a,j)},removeHeader:function*(){n(),p.set(b,j)},write:function*(a,b){n(),p.set(a,b)},writeHeader:function*(a){n(),p.set(b,a)},writeNew:function*(b){var e=(i||(i=d("PromiseOrValue"))).map(g(a,"nextId"),function(a){a===void 0&&(a=0);p.set("nextId",a+1);p.set(a,b);return a});return(h||(h=c("isPromise")))(e)?yield e:e}}}return{getBPlusTreeStore:q,incrementSeed:function*(a,b){a=g(a,"seed");a=(a=(h||(h=c("isPromise")))(a)?yield a:a)!=null?a:0;p.set("seed",Math.max(a,b||0)+1);return b===void 0?a:b},readData:function*(a,b){a=g(a,b);return(h||(h=c("isPromise")))(a)?yield a:a},readDataExn:function*(a,b){a=o(a,b);return(h||(h=c("isPromise")))(a)?yield a:a},readSeed:function(a){return(i||(i=d("PromiseOrValue"))).map(g(a,"seed"),function(a){a===void 0&&(a=0);return a})},remove:function(a,b){n(),p.set(b,j)},writeData:function(a,b,c){n(),p.set(b,l(c))},writeNewData:function*(a,b){a=g(a,"nextId");a=(a=(h||(h=c("isPromise")))(a)?yield a:a)!=null?a:0;p.set("nextId",a+1);p.set(a,l(b));return a}}},types:a.types}},isClosed:a.isClosed||function(){return!1},logError:a.logError,queueCommitWork:(e=a.queueCommitWork)!=null?e:function(a){return a()},runExclusively:a.runExclusively}}g.sentinelDeleted=j;g.isDeletedValue=m;g.createDbStore=a}),98);
__d("ReStoreTransactionLock",["isPromise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){var b=this;this.waitFor=null;a!=null&&(this.waitFor=a.then(function(a){return b.waitFor=null}))}var b=a.prototype;b.chainPromiseOrValue=function(a){if(this.waitFor!=null)return this.waitFor.then(function(){return a("\ud83d\udd12")});else return a("\ud83d\udd12")};return a}();b=function(){function a(){this.lock=null}var b=a.prototype;b.chainPromiseOrValue=function(a){var b=this,d=this.lock;if(d==null){var e=a("\ud83d\udd12");if((h||(h=c("isPromise")))(e))d=e;else return e}else d=d.then(function(){return a("\ud83d\udd12")});var f=d["finally"](function(a){b.lock===f&&(b.lock=null);return a});this.lock=f;return f};return a}();g.WaitForPromiseLock=a;g.ReStoreTransactionLock=b}),98);
__d("IntervalList",["FBLogger","LSDbKeyComparer","ReQLBounds"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){if(a==null)throw c("FBLogger")("messenger_web_product").mustfixThrow("must not be null");return a}function a(a,b){var c=new Map(),e=new Map(),f=new Map();function g(b,c){return c==null?!0:(c.gt!==void 0?a(b,c.gt)>0:c.gte!==void 0?a(b,c.gte)>=0:!0)&&(c.lt!==void 0?a(b,c.lt)<0:c.lte!==void 0?a(b,c.lte)<=0:!0)}function* k(a){var f=0;while(f<a.length&&e.size){f++;var i=a.slice(0,f);f<b&&i.push((h||(h=d("LSDbKeyComparer"))).MAX_KEY);i=e.get(JSON.stringify(i));if(i!=null)for(i of i)yield i}for(i of c.entries()){f=i[0];var j=i[1];c.has(f)&&g(a,j)&&(yield f)}}function l(a){var b=f.get(a);if(b!=null){f["delete"](a);var d=j(e.get(b));d["delete"](a);d.size===0&&e["delete"](b)}else c["delete"](a)}function m(a,g){var h;if(a&&a.gte!=null&&a.lte!=null&&(h=JSON.stringify((i||(i=d("ReQLBounds"))).nextKey(a.gte,b)))===JSON.stringify(a.lte)){var j=e.get(h);j==null&&(j=new Set(),e.set(h,j));j.add(g);f.set(g,h)}else c.set(g,a)}return{"delete":l,findIntersecting:k,set:m}}g["default"]=a}),98);
__d("killswitchMessengerWebPersistedDB",["killswitch"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("killswitch")("MESSENGER_WEB_PERSISTED_DB")}g.check=a}),98);
__d("createReStoreSubscriptionManager",["ExecutionEnvironment","FBLogger","IntervalList","LSDatabaseProviderType","LSDbKeyComparer","LSStorage","MWTabNotifierWhenPDBEnabled","Promise","PromiseOrValue","asyncToGeneratorRuntime","gkx","isPromise","killswitchMessengerWebPersistedDB","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;function a(a,e,f,g){var m;(l||(l=c("ExecutionEnvironment"))).isInBrowser&&c("MWTabNotifierWhenPDBEnabled")!=null&&(m=c("MWTabNotifierWhenPDBEnabled")(g));var n=d("LSDatabaseProviderType").hasPersistentType(f),o=new Map(),p=new Map();function q(a,b){return(i||(i=d("LSDbKeyComparer"))).compareValue(a,b)===0}function r(a,b,c,d){a=(a=C.get(a))!=null?a:[];var e=[];for(var f=0;f<b.length;f++){var g=b[f];for(var h=0;h<32&&g!==0;h++){if(g&1){var i=a[(f<<5)+h];if(!q(c[i],d[i])){e[f]=((i=e[f])!=null?i:0)|1<<h%32}}g=g>>>1}}return e}function s(a,b){for(var c=0;c<Math.max(a.length,b.length);c++)if((a[c]&b[c])!==0)return!0;return!1}function t(a,b,d,e){if(c("gkx")("1583"))try{var f=a(b,d,e);if((k||(k=c("isPromise")))(f))return f["catch"](function(a){c("FBLogger")("messenger_web_product").catching(a).mustfix("error in ReStore subscription async handler")});else return f}catch(a){c("FBLogger")("messenger_web_product").catching(a).mustfix("error in ReStore subscription handlers")}else return a(b,d,e)}function u(a,c,e,f,g){var i=Array.from(c(f));if(g.operation==="put"&&g.prevValue!=null){c=function(){var b=g.prevValue,c=[];for(var h of i){h[0];var k=h[1];k!=null&&k.forEach(function(a,b){c[b]=((b=c[b])!=null?b:0)|a})}var l=r(a,c,b,g.value);return{v:(j||(j=d("PromiseOrValue"))).all(i.map(function(a){var b=a[0];a=a[1];if(a==null||s(l,a))return t(b,f,g,e)}))}}();if(typeof c==="object")return c.v}return(h||(h=b("Promise"))).all(i.map(function(a){var b=a[0];a[1];return t(b,f,g,e)}))}function v(b){return c("nullthrows")((o.has(b)?o:o.set(b,[c("IntervalList")((i||(i=d("LSDbKeyComparer"))).compareKey,a.tableNames[b].primaryKeyIds.length),new Map()])).get(b))}function w(b,e){var f=v(b);f[0];f=f[1];return c("nullthrows")((f.has(e)?f:f.set(e,c("IntervalList")((i||(i=d("LSDbKeyComparer"))).compareKey,a.tableNames[b].indexes[e].length))).get(e))}function x(b,e,f,g,h,k){var l=function(a,c){return u(e,b.findIntersecting,k,a,c)},m=f==null?void 0:d("LSStorage").searchKey(a,e,f,h),n=g==null?void 0:d("LSStorage").searchKey(a,e,g,h);if(n==null&&m!=null)return l(m,{operation:"delete",prevValue:f});if(m==null&&n!=null)return l(n,{operation:"add",value:c("nullthrows")(g)});if(m!=null&&n!=null)return(i||(i=d("LSDbKeyComparer"))).compareKey(m,n)===0?l(m,{operation:"put",prevValue:f,value:c("nullthrows")(g)}):(j||(j=d("PromiseOrValue"))).map(l(m,{operation:"delete",prevValue:f}),function(){return l(n,{operation:"add",value:c("nullthrows")(g)})})}function y(a,b,c,e){var f=v(a),g=f[0],h=f[1];return(j||(j=d("PromiseOrValue"))).map(x(g,a,b,c,null,e),function(){return(j||(j=d("PromiseOrValue"))).all(Array.from(h.entries()).map(function(d){var f=d[0];d=d[1];return x(d,a,b,c,f,e)}).filter(function(a){return a!=null}))})}function z(){p.forEach(function(a){return a()})}function A(a,b){function f(){var d=new Map();try{for(var f of a){var g=f[0],h=f[1];e(b,g)&&d.set(g,h)}}catch(a){c("FBLogger")("messenger_web_product").catching(a).mustfix("Couldnot format changes to broadcast")}return Array.from(d)}if((l||(l=c("ExecutionEnvironment"))).isInBrowser&&(!d("killswitchMessengerWebPersistedDB").check()&&m!=null&&n)){f=f();if(f.length===0)return;m.postMessage(b,f)}}(l||(l=c("ExecutionEnvironment"))).isInBrowser&&(!d("killswitchMessengerWebPersistedDB").check()&&m!=null&&n&&m.onEventReceive("notifyTableV2",function(a){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=new WeakMap(),c=a.values();yield (j||(j=d("PromiseOrValue"))).loop(function(a){if(a.done)return{action:"break",value:void 0};a=a.value;var e=a[0];a=a[1];var f=a.values();return(j||(j=d("PromiseOrValue"))).map(j.loop(function(a){if(a.done)return{action:"break",value:void 0};a=a.value;var c=a[0];a=a[1];return(j||(j=d("PromiseOrValue"))).map(y(e,c,a,b),function(){return{action:"continue",value:f.next()}})},f.next()),function(){return{action:"continue",value:c.next()}})},c.next());z()})())}));var B=new Map(),C=new Map();function D(a,b){if(b==null)return null;var c=B.get(a);c==null&&(c=new Map(),B.set(a,c));var d=[];for(b of b){var e=c.get(b);if(e==null){e=c.size;c.set(b,e);var f=C.get(a);f==null&&(f=[],C.set(a,f));f.push(b)}f=e>>5;e=e&31;d[f]=((f=d[f])!=null?f:0)|1<<e}return d}return{dispose:function(){o.clear(),p.clear()},notifyCommit:z,notifyTableAndIndexSubscribers:y,notifyTableV2:A,subscribeIndex:function(a,c,d,e,f){var g=w(a,c),i=!1;c=function(a,c,e){return i?(h||(h=b("Promise"))).resolve():t(d,a,c,e)};var j=[c,D(a,f)];g.set(e,j);return function(){i=!0,g["delete"](j)}},subscribeTable:function(a,c,d,e){var f=v(a),g=f[0],i=!1;f=function(a,d,e){return i?(h||(h=b("Promise"))).resolve():t(c,a,d,e)};var j=[f,D(a,e)];g.set(d,j);return function(){i=!0,g["delete"](j)}},subscribeToCommit:function(a){p.set(a,a);return function(){p["delete"](a)}}}}g["default"]=a}),98);
__d("ReStore",["BPlusTreeBase","ExecutionEnvironment","FBLogger","I64","LSDatabaseProviderType","LSDbKeyComparer","LSPlatformLsInitLog","LSStorage","LSTableDefaults","MWTabNotifierWhenPDBEnabled","MessengerLogHistory","MetaConfig","Promise","PromiseOrValue","ReQLBounds","ReStoreDefaultValueMigration","ReStoreDefaultValuesMetadata","ReStoreHooks","ReStoreIndicesMigration","ReStorePersistence","ReStoreTransactionLock","ReStoreUtils","asyncToGeneratorRuntime","clearTimeout","cr:1088","cr:1242","createReStoreSubscriptionManager","err","gkx","hashString","isPromise","killswitchMessengerWebPersistedDB","promiseDone","setImmediate","setTimeout","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=d("MessengerLogHistory").getInstance("db_init");e=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.call(this,"Transaction has finished")||this}return b}(babelHelpers.wrapNativeSuper(Error));function p(a){a=(n||(n=d("I64"))).cast(a);if(a===void 0)throw c("unrecoverableViolation")("Expected int64","messenger_web_product");return n.to_float(a)}function q(a,b){function d(b){if(b.done)return b.value;if(!(i||(i=c("isPromise")))(b.value))throw c("unrecoverableViolation")("expected promise","messenger_web_product");return b.value.then(function(b){return d(a.next(b))})}return d(a.next(b))}function r(a,b){return{next:function(c){return b.chainPromiseOrValue(function(b){return q(a.next(b,c))})}}}function s(a,b,e){return c("BPlusTreeBase")((m||(m=d("LSDbKeyComparer"))).compareKey,16,b.getBPlusTreeStore(a,e==null?"root":"index("+e+")"))}function t(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(a,e,f){f===void 0&&(f=[]);var g=d("ReStorePersistence").createDbStore(a),i="restore-table-"+a.uniqueId,v=c("createReStoreSubscriptionManager")(e,a.shouldSync,a.types,i),w=d("ReStoreHooks").createHookManager(f);f=(l||(l=c("ExecutionEnvironment"))).isInBrowser?c("MWTabNotifierWhenPDBEnabled")==null?void 0:c("MWTabNotifierWhenPDBEnabled")(i):void 0;var x=b("LSStorage").searchKey.bind(null,e),y={background:{first:null,last:null},sync_script:{first:null,last:null},ui:{first:null,last:null}},z=c("hashString")(JSON.stringify(e)),A=c("hashString")(JSON.stringify(c("LSTableDefaults")));d("LSPlatformLsInitLog").addAnnotations({"int":{defaultValuesVersion:A,schemaVersion:z}});d("LSPlatformLsInitLog").addPoint("migration_start");o.debug("restore migration start");var B=new(d("ReStoreTransactionLock").WaitForPromiseLock)(g.runExclusively(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("LSPlatformLsInitLog").addPoint("migration_execute_start");var a=new Map(),f=g.createTransaction("readwrite"),i=X(f,a),j="schema_version",k="default_value_version";if(c("MetaConfig")._("59")){var l,m;l=(l=(yield (h||(h=b("Promise"))).resolve(f.table(d("ReStoreDefaultValuesMetadata").schemaVersionTableName).readData(new WeakMap(),j).next().value)))==null?void 0:l.schemaVersion;m=(m=(yield (h||(h=b("Promise"))).resolve(f.table(d("ReStoreDefaultValuesMetadata").schemaVersionTableName).readData(new WeakMap(),k).next().value)))==null?void 0:m.defaultValuesVersion;l!=null&&d("LSPlatformLsInitLog").addAnnotations({"int":{storeDefaultValuesVersion:m,storeSchemaVersion:l}});if(l===z&&m===A){f.close();o.debug("restore migration skipped");d("LSPlatformLsInitLog").addPoint("migration_skipped");return}}try{yield d("ReStoreDefaultValueMigration").runMigrationForTableDefaultValuesIfNeeded(i,e);yield d("ReStoreIndicesMigration").runMigrationForIndicesIfNeeded(i,e,function(b,c){return new(d("ReStoreTransactionLock").ReStoreTransactionLock)().chainPromiseOrValue(function(d){return q(W(a,f,new WeakMap(),b,c,d))})});d("LSPlatformLsInitLog").addPoint("migration_execute_end");o.debug("restore migration complete");l=!0;c("MetaConfig")._("59")&&(a.size===0&&(l=!1),f.table(d("ReStoreDefaultValuesMetadata").schemaVersionTableName).writeData(new WeakMap(),j,{schemaVersion:z}),f.table(d("ReStoreDefaultValuesMetadata").schemaVersionTableName).writeData(new WeakMap(),k,{defaultValuesVersion:A}));yield f.flush({upgrade:l})}catch(a){f.close();throw a}d("LSPlatformLsInitLog").addPoint("migration_end");o.debug("restore migration end")}))["catch"](function(a){d("LSPlatformLsInitLog").addAnnotations({string:{migration_error:a.message}});d("LSPlatformLsInitLog").fail("migration_error");o.debug("restore migration error");throw a})),C=new Map();function D(a,b){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=new WeakMap();yield g.runExclusively(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=new Map(),f=g.createTransaction("readwrite"),h=X(f,b),i=c.values();yield (j||(j=d("PromiseOrValue"))).loop(function(b){if(b.done)return{action:"break",value:void 0};b=b.value;var c=b[0],f=b[1];return(j||(j=d("PromiseOrValue"))).map(j.map(f==null?h.table(a)["delete"](x(a,c)):h.table(a).put(f),function(){return v.notifyTableAndIndexSubscribers(a,c,f,e)}),function(){return{action:"continue",value:i.next()}})},i.next());try{yield f.flush({upgrade:!0})}catch(a){f.close();throw a}}))});return E.apply(this,arguments)}function F(a,b,c,d,e){b=JSON.stringify([b,c]);c=a.get(b);a.set(b,[c==null?d:c[0],e])}function G(a,b,c,d,e,f){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e,f){f=a.table(c);a=s(b,f,d);d=(yield q(a.getWithDefault(e,void 0)));if(d===void 0)return void 0;a=(yield q(f.readDataExn(b,d)));return w.afterGet({tableName:c,value:a})});return H.apply(this,arguments)}function I(a,b,c,d,e,f){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e,f){a=(yield G(a,b,c,d,e,f));return a===void 0?void 0:x(c,a)});return J.apply(this,arguments)}function K(a,b,c,f,g,h){function i(){var l=a.table(c);l=s(b,l,f);var j=l.entries(babelHelpers["extends"]({},(k||(k=d("ReQLBounds"))).extendBounds(h,(f===void 0?e.tableNames[c].primaryKeyIds:e.tableNames[c].indexes[f]).length),{dir:g}));return l={next:function*(a,b){a=(yield* j.next(b));return a.done?{done:!0}:{done:!1,value:a.value[0]}}},l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=i,l}return i()}function L(a,b,c,f,g,h){function i(){var l=a.table(c),m=s(b,l,f),j=m.entries(babelHelpers["extends"]({},(k||(k=d("ReQLBounds"))).extendBounds(h,(f===void 0?e.tableNames[c].primaryKeyIds:e.tableNames[c].indexes[f]).length),{dir:g}));return m={next:function*(a,d){a=(yield* j.next(d));if(a.done)return{done:!0};d=(yield* l.readDataExn(b,a.value[1]));return{done:!1,value:[a.value[0],w.afterEntriesNext({tableName:c,value:d})]}}},m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=i,m}return i()}function* M(a,b,c,f,g,h,i){function j(a,b){return a.length>=b?a:[].concat(a,[(m||(m=d("LSDbKeyComparer"))).MAX_KEY])}if(h!=null&&(m||(m=d("LSDbKeyComparer"))).compareKey(g,h)===0)return;f=e.tableNames[f];var k=f.cascadeUpdates,l=f.primaryKeyIds;f=function*(d){var f=d.indexName;d=d.tableName;var k=e.tableNames[d],m=k.indexes;k=k.primaryKeyIds;var n=f==null?k:m[f];k={gte:g,lte:j(g,n.length)};m=L(b,c,d,f,"asc",k);f=[];k=(yield* m.next(i));while(!k.done)f.push(k.value),k=(yield* m.next(i));for(m of f){m[0];k=m[1];f=x(d,k);if(h===void 0)yield* R(a,b,c,d,f,i),yield* M(a,b,c,d,f,void 0,i);else{k=l.reduce(function(a,b,c){if(c>=h.length)return a;a[n[c]]=h[c];return a},babelHelpers["extends"]({},k));yield* Q(a,b,c,d,f,k,i);yield* M(a,b,c,d,f,x(d,k),i)}}};for(k of k)yield* f(k)}function N(a,b,c,d){return O.apply(this,arguments)}function O(){O=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,f,g){g=e.tableNames[f].autoIncrement;if(!g)throw c("unrecoverableViolation")("only supported for auto-incrementing tables","messenger_web_product");g=(yield a.table(f).readSeed(b));if(g===void 0)throw c("unrecoverableViolation")("unexpected undefined autoIncrementSeed","messenger_web_product");return(n||(n=d("I64"))).of_float(g)});return O.apply(this,arguments)}function* P(a,b,c,f,g,h){var i=b.table(f),j=s(c,i),k=e.tableNames[f];if(k.autoIncrement){var l=g[k.primaryKeyIds[0]];l=(n||(n=d("I64"))).of_float(yield* i.incrementSeed(c,l===void 0?l:p(l)));g[k.primaryKeyIds[0]]=l}l=x(f,g);var o={},q=(yield* j.getWithDefault(l,void 0)),r,t=g;q!==void 0?(r=(yield* i.readDataExn(c,q)),o=S(Object.keys(k.indexes),f,r),i.writeData(c,q,t)):(t=d("ReStoreUtils").appendDefaultValues(g,k.name),q=(yield* i.writeNewData(c,t)),yield* j.set(l,q));g=S(Object.keys(k.indexes),f,t);for(j of Object.keys(g))o[j]!==void 0&&(m||(m=d("LSDbKeyComparer"))).compareKey(o[j],g[j])===0&&(delete g[j],delete o[j]);yield* T(a,b,c,f,g,h);yield* U(b,c,f,q,g);for(k of Object.keys(o)){j=s(c,i,k);yield* j["delete"](o[k])}F(a,f,l,r,t)}function* Q(a,b,c,e,f,g,h){var i=x(e,g);d("LSStorage").areKeysEqual(f,i)||(yield* R(a,b,c,e,f,h));yield* P(a,b,c,e,g,h)}function* R(a,b,c,d,f,g){g=b.table(d);b=s(c,g);var h=e.tableNames[d],i=(yield* b.getWithDefault(f,void 0)),j;if(i!==void 0){j=(yield* g.readDataExn(c,i));if(Object.keys(h.indexes).length)for(h of Object.keys(h.indexes)){var k=x(d,j,h);if(k!=null){var l=s(c,g,h);yield* l["delete"](k)}}yield* b["delete"](f);g.remove(c,i);F(a,d,f,j,void 0)}}function S(a,b,c){return a.reduce(function(a,d){var e=x(b,c,d);a[d]=e;return a},{})}function* T(a,b,c,d,e,f){var g=b.table(d),h=new Set();for(var i of Object.keys(e)){var j=s(c,g,i),k=e[i];j=(yield* j.getWithDefault(k));if(j!=null&&!h.has(j)){k=x(d,yield* g.readDataExn(c,j));yield* R(a,b,c,d,k,f);yield* M(a,b,c,d,k,void 0,f);h.add(j)}}}function* U(a,b,c,d,e){a=a.table(c);for(c of Object.keys(e)){var f=s(b,a,c),g=e[c];yield* f.set(g,d)}}function* V(a,b,c,f,g,h){var i=b.table(f),j=s(c,i),k=e.tableNames[f];if(k.autoIncrement){var l=g[k.primaryKeyIds[0]];l=(n||(n=d("I64"))).of_float(yield* i.incrementSeed(c,l===void 0?l:p(l)));g[k.primaryKeyIds[0]]=l}l=d("ReStoreUtils").appendDefaultValues(g,k.name);g=x(f,l);if(g==null)throw new Error("Evaluating the object store's key path did not yield a value");if(!(yield* j.has(g))){k=S(Object.keys(k.indexes),f,l);yield* T(a,b,c,f,k,h);h=(yield* i.writeNewData(c,l));yield* j.set(g,h);yield* U(b,c,f,h,k);F(a,f,g,void 0,l)}}function* W(a,b,c,d,f,g){var h=b.table(d),i=f.map(function(a){return s(c,h,a)});for(i of i)yield* i.clear();i=f.filter(function(a){var b;return((b=e.tableNames[d])==null?void 0:b.indexes[a])!=null});if(i.length===0)return;f=s(c,h);var j=L(b,c,d,void 0,"asc",void 0),k=[],l=(yield* j.next(g));while(!l.done)k.push(l.value),l=(yield* j.next(g));for(j of k){l=j[0];k=j[1];k=S(i,d,k);yield* T(a,b,c,d,k,g);l=(yield* f.get(l));yield* U(b,c,d,l,k)}}function X(a,c,f){var g=new(d("ReStoreTransactionLock").ReStoreTransactionLock)(),i=new WeakMap(),k=f==null?void 0:f.instanceKey,l={table:function(f){return{add:function(e){return(h||(h=b("Promise"))).resolve((j||(j=d("PromiseOrValue"))).map(w.beforeAdd({tableName:f,transaction:l,value:e}),function(d){return g.chainPromiseOrValue(function(e){b("cr:1242")==null?void 0:b("cr:1242").recordLogicalWrite(k);return q(V(c,a,i,f,d,e))})}))},"delete":function(){for(var d=arguments.length,e=new Array(d),j=0;j<d;j++)e[j]=arguments[j];return(h||(h=b("Promise"))).resolve(g.chainPromiseOrValue(function(d){return q(function*(){b("cr:1242")==null?void 0:b("cr:1242").recordLogicalWrite(k),yield* R(c,a,i,f,e,d),yield* M(c,a,i,f,e,void 0,d)}())}))},deleteThenInsert:function(e){return(h||(h=b("Promise"))).resolve((j||(j=d("PromiseOrValue"))).map(w.beforeDeleteThenInsert({tableName:f,transaction:l,value:d("ReStoreUtils").appendDefaultValues(e,f)}),function(d){return g.chainPromiseOrValue(function(e){return q(function*(){b("cr:1242")==null?void 0:b("cr:1242").recordLogicalWrite(k),yield* P(c,a,i,f,d,e),yield* M(c,a,i,f,x(f,d),void 0,e)}())})}))},entries:function(b,c,d){c===void 0&&(c="asc");return r(L(a,i,f,void 0,c,d),g)},get:function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return(h||(h=b("Promise"))).resolve(g.chainPromiseOrValue(function(b){return G(a,i,f,void 0,d,b)}))},index:function(c){return{entries:function(b,d,e){d===void 0&&(d="asc");return r(L(a,i,f,c,d,e),g)},get:function(){for(var d=arguments.length,e=new Array(d),j=0;j<d;j++)e[j]=arguments[j];return(h||(h=b("Promise"))).resolve(g.chainPromiseOrValue(function(b){return G(a,i,f,c,e,b)}))},getKey:function(){for(var d=arguments.length,e=new Array(d),j=0;j<d;j++)e[j]=arguments[j];return(h||(h=b("Promise"))).resolve(g.chainPromiseOrValue(function(b){return I(a,i,f,c,e,b)}))},keyFields:e.tableNames[f].indexes[c],keys:function(b,d,e){d===void 0&&(d="asc");return r(K(a,i,f,c,d,e),g)}}},keyFields:e.tableNames[f].primaryKeyIds,keys:function(b,c,d){c===void 0&&(c="asc");return r(K(a,i,f,void 0,c,d),g)},peekNextAutoIncrementId:function(){return(h||(h=b("Promise"))).resolve(g.chainPromiseOrValue(function(b){return N(a,i,f,b)}))},put:function(e){return(h||(h=b("Promise"))).resolve((j||(j=d("PromiseOrValue"))).map(w.beforePut({tableName:f,transaction:l,value:e}),function(d){return g.chainPromiseOrValue(function(e){b("cr:1242")==null?void 0:b("cr:1242").recordLogicalWrite(k);return q(P(c,a,i,f,d,e))})}))},upsert:function(e,m){return(h||(h=b("Promise"))).resolve((j||(j=d("PromiseOrValue"))).map(w.beforeUpsert({tableName:f,transaction:l,value:m}),function(d){return g.chainPromiseOrValue(function(g){return q(function*(){b("cr:1242")==null?void 0:b("cr:1242").recordLogicalWrite(k),yield* Q(c,a,i,f,e,d,g),yield* M(c,a,i,f,e,x(f,m),g)}())})}))}}}};return l}var Y;function Z(a,d){return new(h||(h=b("Promise")))(function(b,e){c("gkx")("789")&&(Y=e),y[d].last==null?y[d].first=y[d].last={value:function(){return a().then(b,e)}}:y[d].last=y[d].last.next={value:function(){return a().then(b,e)}}})}function aa(){return g.runExclusively(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=y.ui.first!=null?y.ui:y.sync_script.first!=null?y.sync_script:y.background;if(a.first==null){c("FBLogger")("messenger_web_product").mustfix("Expected work is missing");return}var b=a.first;a.first===a.last&&(a.last=null);a.first=a.first.next;yield b.value()}))}function ba(a,b,c){return $.apply(this,arguments)}function $(){$=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e,f,i){i===void 0&&(i="background");var k,l,m,n,o,p,q=b("cr:1242")==null?void 0:b("cr:1242").startTracking(a.types,i);(c("MetaConfig")._("26")||c("MetaConfig")._("27")||b("cr:1088"))&&(k=c("err")("Transaction timeout"));b("cr:1088")&&(l=Date.now());function f(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){b("cr:1242")==null?void 0:b("cr:1242").mark(q,"execute_start");b("cr:1088")&&(m=Date.now());var a={ref:void 0},f=new Map(),i=g.createTransaction("readwrite"),r;try{var s=X(i,f,{instanceKey:q});r=(yield (h||(h=b("Promise"))).race([e(s),u(k,a)]));a.ref!=null&&c("clearTimeout")(a.ref);b("cr:1088")&&(n=Date.now());b("cr:1242")==null?void 0:b("cr:1242").mark(q,"execute_end");b("cr:1242")==null?void 0:b("cr:1242").mark(q,"flush_start");yield i.flush({instanceKey:q});b("cr:1242")==null?void 0:b("cr:1242").mark(q,"flush_end")}catch(d){a.ref!=null&&c("clearTimeout")(a.ref);i.close();b("cr:1242")==null?void 0:b("cr:1242").fail(q);throw d}b("cr:1088")&&(p=Date.now());b("cr:1242")==null?void 0:b("cr:1242").mark(q,"broadcast_start");var t=new WeakMap(),x=new Map();for(s of f){a=s[0];i=s[1];a=JSON.parse(a);var y=a[0];a[1];a=x.get(y);a==null&&(a=[],x.set(y,a));var z=i[0];i=i[1];i=w.beforeNotify({newValue:i,prevValue:z,tableName:y});z=i.newValue;y=i.prevValue;a.push([y,z])}var A=x.entries();yield (j||(j=d("PromiseOrValue"))).loop(function(b){if(b.done)return{action:"break",value:void 0};b=b.value;var a=b[0];b=b[1];var c=b.values();return(j||(j=d("PromiseOrValue"))).map(j.loop(function(b){if(b.done)return{action:"break",value:void 0};b=b.value;var e=b[0];b=b[1];return(j||(j=d("PromiseOrValue"))).map(v.notifyTableAndIndexSubscribers(a,e,b,t),function(){return{action:"continue",value:c.next()}})},c.next()),function(){return{action:"continue",value:A.next()}})},A.next());yield g.queueCommitWork(function(){v.notifyTableV2(x,"notifyTableV2");v.notifyTableV2(x,"notifyInMemoryTable");return(h||(h=b("Promise"))).resolve()});v.notifyCommit();if(b("cr:1088")){o=Date.now();i={broadcast:o,complete:n,flush:p,queue:l,start:m};b("cr:1088").recordRestoreTransaction(k,i,{changedKeys:f})}b("cr:1242")==null?void 0:b("cr:1242").mark(q,"broadcast_end");b("cr:1242")==null?void 0:b("cr:1242").mark(q,"post_commit_start");c("setImmediate")(function(){b("cr:1242")==null?void 0:b("cr:1242").mark(q,"post_commit_end"),b("cr:1242")==null?void 0:b("cr:1242").end(q)});return r});return r.apply(this,arguments)}var s=i==="background"&&c("MetaConfig")._("39")?new(h||(h=b("Promise")))(function(a){return c("setTimeout")(a,0)}):(h||(h=b("Promise"))).resolve();yield s;s=Z(f,i);c("promiseDone")(aa(),function(){},function(a){Y==null?void 0:Y(a)});return s});return $.apply(this,arguments)}i=d("LSDatabaseProviderType").hasPersistentType(a.types);(l||(l=c("ExecutionEnvironment"))).isInBrowser&&(!d("killswitchMessengerWebPersistedDB").check()&&f!=null&&i&&f.onEventReceive("notifyInMemoryTable",function(d){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var b of d){var c=b[0],e=b[1];a.shouldApplySync("notifyInMemoryTable",c)&&(yield D(c,e))}v.notifyCommit()})())}));return{clearCacheIfSupported:function(){var a=g;a instanceof Object&&a.clearCache!==void 0&&a.clearCache instanceof Function&&a.clearCache()},closeDb:function(){var a=g;a instanceof Object&&a.close!==void 0&&a.close()},getTableData:function(){return e},isClosed:function(){return g.isClosed()},persistenceTypes:a.types,runInTransaction:ba,subscribeToCommit:function(a){return v.subscribeToCommit(a)},subscriptionManager:v,table:function(a){return t(C,a,function(){var b=new Map();return{entries:function(b,c,d){c===void 0&&(c="asc");return r(L(g.createTransaction("readonly"),b,a,void 0,c,d),B)},get:function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return B.chainPromiseOrValue(function(b){return G(g.createTransaction("readonly"),new WeakMap(),a,void 0,c,b)})},index:function(c){return t(b,c,function(){return{entries:function(b,d,e){d===void 0&&(d="asc");return r(L(g.createTransaction("readonly"),b,a,c,d,e),B)},get:function(){for(var b=arguments.length,d=new Array(b),e=0;e<b;e++)d[e]=arguments[e];return B.chainPromiseOrValue(function(b){return G(g.createTransaction("readonly"),new WeakMap(),a,c,d,b)})},getKey:function(){for(var b=arguments.length,d=new Array(b),e=0;e<b;e++)d[e]=arguments[e];return B.chainPromiseOrValue(function(b){return I(g.createTransaction("readonly"),new WeakMap(),a,c,d,b)})},keyFields:e.tableNames[a].indexes[c],keys:function(b,d,e){d===void 0&&(d="asc");return r(K(g.createTransaction("readonly"),b,a,c,d,e),B)},subscribe:function(b,f,g){return v.subscribeIndex(a,c,b,(k||(k=d("ReQLBounds"))).extendBounds(f,e.tableNames[a].indexes[c].length),g)}}})},keyFields:e.tableNames[a].primaryKeyIds,keys:function(b,c,d){c===void 0&&(c="asc");return r(K(g.createTransaction("readonly"),b,a,void 0,c,d),B)},peekNextAutoIncrementId:function(){return B.chainPromiseOrValue(function(b){return N(g.createTransaction("readonly"),new WeakMap(),a,b)})},subscribe:function(b,c,f){return v.subscribeTable(a,b,(k||(k=d("ReQLBounds"))).extendBounds(c,e.tableNames[a].primaryKeyIds.length),f)}}})}}}function u(a,d){return(l||(l=c("ExecutionEnvironment"))).canUseDOM&&c("MetaConfig")._("27")?new(h||(h=b("Promise")))(function(b,e){var f=5e3;d.ref=c("setTimeout")(function(){c("FBLogger")("messenger_web_product").catching(a).blameToPreviousFrame().mustfix("ReStore transaction took longer than %s ms to execute",f.toString()),e(a)},f)}):new(h||(h=b("Promise")))(function(){})}a.TransactionClosedError=e;g["default"]=a}),98);
__d("createReStoreEphemeralPersistence",["FBLogger","Promise","ReStorePersistence","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return(a.has(b)?a:a.set(b,c())).get(b)}function a(){var a=(h||(h=b("Promise"))).resolve(),e=new Map();function f(a){return i(e,a,function(){return new Map()})}return{flush:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.forEach(function(a,b){var c=f(b);a.forEach(function(a,b){d("ReStorePersistence").isDeletedValue(a)?c["delete"](b):c.set(b,a)})})});function c(b){return a.apply(this,arguments)}return c}(),get:function(a,b,c){a=f(b);return a.get(c)},logError:function(a,b,d,e){if(d==="dbCorruption"){throw c("FBLogger")("messenger_web_product").mustfixThrow("Got unexpected undefined in edb, mode: %s, table: %s, id: %s, deletedInThisTxn: %s",b,a,(d=e==null?void 0:e.id)!=null?d:"",(b=e==null?void 0:e.deletedInThisTxn)!=null?b:"")}},queueCommitWork:void 0,runExclusively:function(c){return new(h||(h=b("Promise")))(function(d,e){a=a.then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{d(yield c())}catch(a){e(a)}}))})},shouldApplySync:function(){return!1},shouldSync:function(){return!1},types:["ephemeral"],uniqueId:""}}g["default"]=a}),98);
__d("LSJSInMemoryStorage",["MAWLSVaultingHooks","ReStore","createReStoreEphemeralPersistence"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("ReStore")(c("createReStoreEphemeralPersistence")(),a,[c("MAWLSVaultingHooks")])}g["default"]=a}),98);
__d("MWLSSchemaEphemeral",["FBLogger","LSJSInMemoryStorage","LSMetadata","LSPlatformLsInitLog","MAWLSVaultingHooks","MWConditionallySetupEBStateDB","MessengerLogHistory","ReStore","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MessengerLogHistory").getInstance("db_init");function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("LSPlatformLsInitLog").addPoint("init_start");var a;try{var b=(yield d("MWConditionallySetupEBStateDB").conditionallyMakeEBStateDB());b!=null&&(h.debug("Creating EB State DB"),a=c("ReStore")(b,d("LSMetadata").metadata,[c("MAWLSVaultingHooks")]),h.debug("EB State DB inited"))}catch(a){c("FBLogger")("messenger_web_clients").catching(a).mustfix("EBSM failed")}a==null&&(h.debug("Creating EDB"),a=c("LSJSInMemoryStorage")(d("LSMetadata").metadata),h.debug("EDB inited"));d("LSPlatformLsInitLog").addPoint("init_end");return a});return i.apply(this,arguments)}g.createDB=a}),98);
__d("MWLSSchemaEphemeralProxy",["MWLSSchemaEphemeral"],(function(a,b,c,d,e,f){"use strict";Object.keys(importNamespace("MWLSSchemaEphemeral")).forEach(function(a){if(a==="default"||a==="__esModule")return;f[a]=importNamespace("MWLSSchemaEphemeral")[a]})}),null);
__d("GetLsDatabase",["ExecutionEnvironment","FBLogger","InteractionTracing","LSDefaultSyncGroups","LSPlatformLsInitLog","MAWDropCutoverThreadsTable","MWLSSchemaEphemeralProxy","MessengerLogHistory","MultipleTabsLogger","Promise","UserTimingUtils","asyncToGeneratorRuntime","cr:4489","cr:5774","cr:665","cr:7000","cr:7351","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(e=b("cr:7000"))!=null?e:b("cr:7351"),k=c("gkx")("4471")&&c("gkx")("4463"),l=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("MessengerLogHistory").getInstance("db_init"),e=(yield d("MultipleTabsLogger").getMultipleTabsAnnotation());a.debug("Has multiple tabs: "+e);d("MultipleTabsLogger").addAnnotationToQPLEvent(c("qpl")._(25305590,"1127"));a.debug("====Creating DB====");b("cr:4489")!=null&&b("cr:665")!=null&&(a.debug("Vaulting setup started"),b("cr:665").setupMainWaLogger(),yield d("UserTimingUtils").asyncMeasure("Setup Vaulting Materials",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield b("cr:4489").setupVaultMaterials()})),a.debug("Vaulting setup finished"));d("LSPlatformLsInitLog").addPoint("support_check_start");var f=b("cr:5774").isSupported!=null?yield b("cr:5774").isSupported():!1;d("LSPlatformLsInitLog").addPoint("support_check_end",{bool:{using_pdb:f}});c("InteractionTracing").getPendingInteractions().forEach(function(a){a.addAnnotationBoolean("using_pdb",f)});f&&self.navigator.locks==null&&c("FBLogger")("messenger_web_product").mustfix("PDB exposed to people without navigator.locks");a.debug("Connecting to DB");e=f?yield b("cr:5774").createDB():yield d("MWLSSchemaEphemeralProxy").createDB();a.debug("Connecting established");yield e.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=k||j==null?[(i||(i=b("Promise"))).resolve(),(i||(i=b("Promise"))).resolve()]:[j.call(c),d("MAWDropCutoverThreadsTable").call(c)],f=e[0];e=e[1];yield (i||(i=b("Promise"))).all([f,e]);d("LSPlatformLsInitLog").addPoint("success_maw_data_deletion");a.debug("Seeding DB");yield d("LSDefaultSyncGroups").seedDb(c,void 0);a.debug("DB seeded")});return function(a){return c.apply(this,arguments)}}(),"readwrite","ui");a.debug("====DB created====");return e});return function(){return a.apply(this,arguments)}}(),m;function a(){m==null&&(m=(h||(h=c("ExecutionEnvironment"))).isInBrowser?l():new(i||(i=b("Promise")))(function(){}));return m}g.get=a}),98);
__d("getVideoPlayerUserFacingErrorMessageFromError",["fbt","gkx"],(function(a,b,c,d,e,f,g,h){"use strict";function i(a){return c("gkx")("1792489")&&a.message.toLowerCase().indexOf("audio_renderer_error")>=0}function j(a){return c("gkx")("4281")&&a.message.indexOf("DEVICE_CERTIFICATE_REVOKED")>=0}function k(a){return c("gkx")("1076")&&(a.name.indexOf("VideoImplementationsDashManifestUnsupportedCodecs")>=0||a.name.indexOf("VideoImplementationsMediaSourceUnsupported")>=0)}function a(a){var b=null;i(a)?b=h._("\u97f3\u8a0a\u8f49\u8b6f\u5668\u932f\u8aa4\uff1a\u8acb\u91cd\u65b0\u555f\u52d5\u96fb\u8166\u3002"):j(a)?b=h._("\u9019\u6bb5\u5f71\u7247\u53d7 DRM \u6280\u8853\u4fdd\u8b77\uff0c\u800c\u4f60\u7684\u88dd\u7f6e\u6191\u8b49\u4f3c\u4e4e\u5df2\u64a4\u92b7\u3002\u8acb\u78ba\u8a8d\u4f7f\u7528\u7684\u700f\u89bd\u5668\u70ba\u6700\u65b0\u7248\u672c\uff0c\u7136\u5f8c\u518d\u8a66\u4e00\u6b21\u3002"):k(a)&&(b=h._("\u7121\u6cd5\u5728\u4f60\u4f7f\u7528\u7684\u700f\u89bd\u5668\u3001\u4f5c\u696d\u7cfb\u7d71\u6216\u786c\u9ad4\u64ad\u653e\u9019\u6bb5\u5f71\u7247\u3002"));return b}g["default"]=a}),98);